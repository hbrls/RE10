# Vue 3 + UniApp 技术选型与架构审查参考

## 1. 适用范围

用于 `Vue 3 + TypeScript + Vite + UniApp` 项目的架构质量审查，重点覆盖：

- 构建与依赖管理（Build）
- 基础框架（Base Framework）
- 工具层（Utils / Libs / Composables / Hooks）
- 业务组件与页面组织
- 第三方库集成与隔离

## 2. 项目事实基线（审查前先确认）

结合当前仓库约定，先确认以下基线：

- 构建体系：`Vite + UniApp`
- 主要目录：`src/pages`、`src/basePackage`、`src/pluginPackage`、`src/components`、`src/store`、`src/libs`、`src/utils`
- 状态管理：`Pinia` + `store/dispatcher`
- UI 组件：`uni_modules/vk-uview-ui`
- 约定：`libs` 偏业务复用，`utils` 偏通用工具
- 小程序体积：主包建议控制在 `2MB` 以内

## 3. 五大审查维度（Vue3 + UniApp 定向）

### 3.1 Build（构建与依赖）

重点检查：

- `vite.config.ts`、`pages.json`、`manifest.json` 是否职责清晰、配置一致
- 依赖版本是否可追踪（`package.json` + lock 文件）
- `@dcloudio/*` 相关版本是否一致
- 环境变量是否使用 `import.meta.env`，避免 `process.env`
- 多平台构建与条件编译（`#ifdef / #ifndef`）是否规范
- 分包策略是否合理，是否把非必要组件打入主包
- 构建配置中是否存在敏感信息（密钥、账号、调试开关未隔离）

### 3.2 Base Framework（基础框架）

重点检查：

- 是否统一使用 Vue 3 Composition API + `<script setup>`
- 分层边界是否清晰（View / 业务逻辑 / 数据访问）
- 是否规范使用 Pinia 与 dispatcher（`useXxxDispatcher`）
- 基础组件（如 `q-nav`、`q-loading`、`q-section`）是否仅承担通用能力
- 请求层（如 `src/libs/request`）是否统一处理错误、超时、重试、类型定义
- 日志与错误收集是否分环境治理，避免敏感信息泄漏
- 配置是否集中到 `constant/config`，避免硬编码散落

### 3.3 Utils（工具层）

重点检查：

- `libs` 与 `utils` 职责是否清晰，避免“工具黑洞”
- Composables/Hooks 是否单一职责、可复用、命名清晰（`useXxx`）
- 是否存在全局状态滥用或长期持有组件引用
- 是否正确处理响应式数据（解构、引用传递）
- 是否正确处理跨平台差异（优先 `uni.*`，必要时条件编译）
- 工具函数与 Composables 是否可单测（建议覆盖边界输入）

### 3.4 业务组件与页面组织

重点检查：

- 单组件复杂度是否可控（行数、方法数、流程分支）
- UI 与业务逻辑是否分离（下沉到 Store/Composables/Hooks/Service）
- 页面导航是否集中管理（避免路由路径硬编码）
- 页面参数传递、失败回退、异常提示是否完整
- 主包/基础分包/插件分包边界是否清晰
- 分包内 `apis/components/hooks` 是否与业务域一致
- 长列表是否采用分页或虚拟化等策略

### 3.5 第三方库（集成与隔离）

重点检查：

- 第三方能力是否通过适配层封装，避免业务直调 SDK
- 初始化时机是否合理（避免阻塞首屏）
- `uni_modules` 是否有版本治理；避免直接改源码，必要时保留 patch 记录
- 失败场景是否有降级策略，不阻断核心流程
- 版本兼容性与安全公告是否持续跟踪
- 权限申请、隐私采集、授权撤回后行为是否合规
- 多库并存下是否评估体积、样式冲突与性能影响

## 4. 快速审查流程（推荐）

1. 先做项目结构与分包地图梳理（目录、依赖、主包/分包关系）
2. 审查构建与配置（Vite、pages、manifest、env、版本锁定）
3. 审查基础框架（分层、状态、网络层、日志配置）
4. 审查工具层与业务页面（职责、复用、复杂度、边界）
5. 审查第三方库（封装、生命周期、降级、合规）
6. 输出问题清单：按“高/中/低”+“改造成本”排序，给出优先级

## 5. 报告模板（精简版）

```markdown
# [项目名] Vue3 + UniApp 架构质量审查报告

## 1. 项目概览
- 技术栈与目标平台（H5/小程序/App）
- 页面规模与分包情况

## 2. 审查结果总览
- 关键风险（Top N）
- 架构优势

## 3. 分维度问题明细
### 3.1 Build
### 3.2 Base Framework
### 3.3 Utils
### 3.4 业务组件与页面
### 3.5 第三方库

## 4. 优先级改进计划
- P0（立即）
- P1（近期）
- P2（中期）

## 5. 附录
- 证据文件与关键代码位置
```

## 6. 与通用 Skill 的关系

本文件聚焦 `Vue3 + UniApp` 场景细节，作为通用架构审查 Skill 的技术选型补充。执行审查时应优先使用主 Skill 流程，再按本参考补充平台特有检查项。

## 7. 代理角色映射与协作建议（来自 AGENTS）

在执行 Vue3 + UniApp 架构审查时，建议按以下角色分工协作：

### 7.1 核心开发代理（主审查链路）

- 前端开发专家：负责组件结构、Composition API 使用规范、跨平台页面实现合理性
- API 集成专家：负责请求拦截、错误处理、重试机制、接口契约一致性
- 状态管理专家：负责 Pinia 模块边界、全局状态同步与持久化策略

### 7.2 业务领域代理（业务正确性与可维护性）

- 电商业务专家：检查商品、购物车、结算、订单主流程的架构一致性
- 用户系统专家：检查认证鉴权、权限边界、账号安全策略
- 营销活动专家：检查优惠券、分销、活动模块的领域隔离与复用性

### 7.3 技术专项代理（质量与风险兜底）

- 性能优化专家：关注包体积、首屏加载、长列表和资源加载策略
- 跨平台适配专家：关注条件编译、平台 API 适配、样式兼容性
- 测试质量专家：关注单测/集成测试覆盖、回归策略、质量门禁

### 7.4 运维部署代理（发布与运行保障）

- 构建部署专家：关注构建流程、环境配置与发布策略
- 监控运维专家：关注日志、性能指标、错误告警与故障排查闭环

### 7.5 协作原则（审查执行规范）

- 职责边界：每个角色专注自身领域，避免重复审查与结论冲突
- 沟通协作：统一术语和评估口径，及时同步关键决策
- 知识共享：将结论、模板、最佳实践沉淀到文档并持续更新

### 7.6 任务到角色的快速映射

- 功能开发相关问题：前端开发专家 + 对应业务专家
- 性能问题：性能优化专家
- 跨平台问题：跨平台适配专家
- 构建与发布问题：构建部署专家

复杂问题建议采用“主导角色 + 辅助角色”模式：主导角色负责整体方案，辅助角色提供专项建议，最终结论统一收敛到同一份审查报告。
