---
name: memory
description: AI个人记忆系统的记忆查询功能。检索各层级记忆文件，综合多层级信息回答用户问题；在迁移阶段保持原有能力结构与层级设计完整，允许存在占位路径或暂未落地文件。
---

# 记忆查询

## 使用定位

- 默认面向**个人使用**。
- 可作为 AI 的执行指令使用，文档语气以“可操作步骤”为主。
- 迁移阶段保持术语体系稳定（L1/L2/L3/L4），避免频繁改名。

## 目标与边界

本 command 的目标：

1. 快速定位与用户问题最相关的记忆层级与文件。
2. 以“证据优先”方式回答：先事实、后解释、再建议。
3. 明确来源、时间与置信度，避免把旧记录当成当前结论。

适用场景：

- 用户问“我的记忆里关于 XXX 是什么？”
- 用户询问自己的习惯/偏好/决策方式/价值观
- 需要基于用户历史给出个性化建议

不适用场景：

- 纯知识问答（与用户记忆无关）
- 需要实时外部信息（新闻、行情、最新政策）
- 用户明确要求“不要参考历史记忆”

## 迁移兼容策略（当前阶段）

1. **保持架构完整优先**：先保留 L1-L4 分层能力与流程骨架，不因局部缺失文件打断整体设计。
2. **允许占位路径存在**：若文档示例中提及的文件在本项目尚不存在，可保留为目标路径或规划位。
3. **执行时容错**：检索不到文件时，继续检索同层或相邻层，默认静默处理，不额外展开说明。
4. **渐进式收敛**：后续根据真实使用频率，再逐步删改低价值路径与规则。

---

## 快速开始（30 秒版）

当用户询问“关于我自己的历史/偏好/模式”时，按以下顺序执行：

1. **读取 INDEX.md**：获取记忆地图。
2. **判断问题类型**：事实、偏好、决策、价值观、近期事件。
3. **确定检索层级**：优先 L4，再按问题下钻 L3/L2/L1。
4. **关键词检索 + 读取原文**：先搜再读，优先读取 2 个证据点（不足可继续）。
5. **生成回答**：输出结论、证据引用、置信度、缺口说明。

---

## 检索协议

### 标准流程

```
用户提问
  ↓
读取 AI_MEMORY/INDEX.md
  ↓
识别问题类型（事实/偏好/决策/价值观/近期事件）
  ↓
选择检索层级（L4 必看，按需扩展 L3/L2/L1）
  ↓
关键词搜索（grep_search）→ AI_MEMORY/
  ↓
读取匹配文件
  ↓
提取证据（记录“时间 + 原句 + 文件路径”）
  ↓
冲突检测（跨层级、跨时间）
  ↓
用 L4 价值观校准建议
  ↓
生成回复（结论 + 引用 + 置信度 + 待确认项）
```

### 检索优先级

1. **L4 核心层（优先）**：用于价值观校准与最终建议对齐（若文件缺失，需标注并继续）
2. **L3 认知层**：涉及“如何思考/如何决策”时优先读取
3. **L2 行为层**：涉及“习惯/偏好/执行风格”时优先读取
4. **L1 情境层**：涉及“近期发生了什么/当前状态”时优先读取

### 问题类型 → 层级映射

1. **价值观类**（“我最看重什么”）
   - 必读：L4
   - 补充：L1（校验近期是否出现偏离）
2. **决策类**（“我通常怎么做选择”）
   - 必读：L3 + L4
   - 补充：L2（行为落地）
3. **习惯/偏好类**（“我习惯怎么推进任务/喜欢什么工具”）
   - 必读：L2
   - 补充：L1（近期变化）+ L4（是否与价值观冲突）
4. **近期事件类**（“我上周做了什么”）
   - 必读：L1
   - 补充：L2/L3（若需要解释原因）

---

## 检索执行规范

### 关键词策略

每次检索至少准备两组关键词：

1. **用户原词**：保留用户表述（例：复杂任务、拖延、沟通）
2. **同义扩展词**：补齐可能表达（例：流程、习惯、偏好、决策、原则）

建议组合（示例）：

- 工作习惯：`工作习惯|工作流|复杂任务|执行步骤|推进方式`
- 决策方式：`决策|选择|判断|取舍|权衡`
- 价值观：`价值观|原则|底线|重要|优先级`
- 工具偏好：`工具|偏好|效率|常用|不喜欢`

### 证据提取标准

每条证据应包含：

1. **来源路径**（具体到文件）
2. **时间信息**（若有日期）
3. **原文要点**（避免过度改写）

证据不足处理：

- 若仅有 1 条弱证据：明确标注“低置信度”
- 若无证据：直接说明“未找到相关记忆”，并询问是否补录

---

## 回答结构（标准模板）

```md
结论：{一句话回答用户问题}

依据：
1. {证据1摘要}（来源：{文件路径}）
2. {证据2摘要}（来源：{文件路径}）

综合判断：{跨层级整合后的解释，区分事实与推断}

置信度：{高/中/低}
原因：{证据数量、时间新旧、是否冲突}

如需确认：{1 个最关键澄清问题}
```

### 引用格式规范

- 单来源：`（来源：L2_行为层/工作习惯.md）`
- 多来源：
  - `（来源1：L3_认知层/决策框架.md）`
  - `（来源2：L1_情境层/2026-02.md）`

### 置信度判定规则

1. **高**：≥2 条一致证据，且含近期记录
2. **中**：有证据但时间较久，或仅单层支持
3. **低**：证据稀少、冲突明显或仅弱相关

---

## 常见查询范式

### 1) 查询工作习惯

问题示例：`“我通常如何处理复杂任务？”`

检索建议：

- 搜索 L2：`复杂任务|工作流|执行步骤`
- 读取 L2 相关文件
- 追加读取 L3（查看决策框架）
- 用 L4 校准建议语气与优先级

### 2) 查询价值观

问题示例：`“我最看重什么？”`

检索建议：

- 必读 L4 核心价值观文件
- 可选读取 L1 最近记录，验证是否有新变化

### 3) 查询近期事件

问题示例：`“我上周做了什么？”`

检索建议：

- 读取 L1 对应月份/周记录
- 按日期抽取事件，按时间顺序汇总

### 4) 查询工具偏好

问题示例：`“我喜欢用什么工具？”`

检索建议：

- 搜索 L2：`工具|偏好|效率|常用`
- 用 L1 校验近期是否出现偏好迁移

---

## 异常与冲突处理

### 未找到相关记忆

输出建议：

```md
我在现有记忆中没有找到与你这个问题直接相关的记录。

可能原因：
1. 这是新情况，尚未沉淀为模式
2. 过去讨论过但未被记录

如果你愿意，我可以按这次结论先给出建议，并在后续帮你补充记忆条目。
```

### 记忆冲突

冲突判定：不同层级或不同时间记录互相矛盾。

处理顺序：

1. 先报告冲突，不直接替用户裁决
2. 标注“长期模式 vs 近期例外”
3. 提出一个最小澄清问题

输出建议：

```md
我发现两条记录存在冲突：
- {旧记录}（来源：{路径A}）
- {新记录}（来源：{路径B}）

当前更可能是：{偏好变化/情境差异/记录噪声}。
你希望我以后按哪条作为默认偏好？
```

---

## 关键原则（必须遵守）

1. **先证据，后判断**：没有证据不下结论。
2. **总是引用来源**：每个关键判断都可追溯。
3. **L4 校准建议**：建议必须与用户核心价值观一致。
4. **诚实处理空白**：找不到就明确说明，不编造。
5. **区分事实与推断**：用语上明确“记录显示”与“我推测”。
6. **优先近期信息**：发生冲突时先比较时间与场景。
7. **保留架构完整性**：迁移阶段允许“能力先行、文件后补”。
8. **默认静默容错**：占位路径或缺失文件不作为主输出焦点，除非用户追问。
